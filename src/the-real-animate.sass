@import 'animate-bank'

// Config
$__animateCaching: true !default
$__animateDuration: 1000ms !default
$__animateUsedKeyframes: () !default

// Mixin
=animate($name, $duration: $__animateDuration, $cache: $__animateCaching)
  $extraProps: false
  $cachedProps: ()
  // Check bank
  @if map-has-key($__animateBank, $name)

    // Check if keyframe is already rendered
    @if not index($__animateUsedKeyframes, $name)
      $__animateUsedKeyframes: append($__animateUsedKeyframes, $name) !global

      // Create keyframe entry
      @keyframes #{$name}
        @each $stop, $styles in map-get($__animateBank, $name)
          @if $stop != default
            #{$stop}
              @each $prop, $value in $styles
                #{$prop}: $value
                // Get props to accelerate
                @if $cache and not index($cachedProps, $prop)
                  $cachedProps: append($cachedProps, $prop, comma)
          @else
            $extraProps: $styles

    // Set animation properties on element
    animation-name: $name
    animation-duration: $duration
    animation-fill-mode: both // animate.css default

    // Add extra animation defaults
    @if $extraProps
      @each $prop, $value in $extraProps
        #{$prop}: $value

    // Hardware acceleration
    will-change: if(length($cachedProps) > 0, $cachedProps, null)

  @else
    @error '\'#{$name}\' not found in animation bank.'

div
  +animate(bounceIn)
